---
# SPDX-License-Identifier: MIT-0
# Node.js installation via the NodeSource rpm stream

- name: Download NodeSource setup script
  ansible.builtin.get_url:
    url: "{{ developer_nodesource_setup_url }}/setup_{{ developer_node_version }}.x"
    dest: "/tmp/nodesource-setup.sh"
    mode: "0755"
  tags:
    - nodejs
    - javascript

- name: Configure NodeSource repository for Node.js
  ansible.builtin.shell:
    cmd: /tmp/nodesource-setup.sh
    executable: /bin/bash
    creates: "/etc/yum.repos.d/nodesource-nodejs-{{ developer_node_version }}.repo"
  tags:
    - nodejs
    - javascript

- name: Clean up NodeSource setup script
  ansible.builtin.file:
    path: /tmp/nodesource-setup.sh
    state: absent
  tags:
    - nodejs
    - javascript

- name: Install Node.js
  ansible.builtin.dnf:
    name: nodejs
    state: present
  tags:
    - nodejs
    - javascript

- name: Verify Node.js installation
  ansible.builtin.command:
    cmd: node -v
  register: developer_node_version
  changed_when: false
  tags:
    - nodejs
    - javascript

- name: Display Node.js version
  ansible.builtin.debug:
    msg: "Node.js {{ developer_node_version.stdout }} installed"
  when: developer_node_version.stdout is defined
  tags:
    - nodejs
    - javascript
