---
# SPDX-License-Identifier: MIT-0
# Python tooling installation (uv - modern Python package manager)

- name: Check if uv binary exists
  ansible.builtin.stat:
    path: "{{ ansible_facts['user_dir'] }}/.local/bin/uv"
  register: developer_uv_check
  become: false
  tags:
    - python
    - uv

- name: Install uv (modern Python package manager)
  ansible.builtin.get_url:
    url: "{{ developer_uv_install_url }}"
    dest: /tmp/install-uv.sh
    mode: "0755"
  when: not developer_uv_check.stat.exists
  tags:
    - python
    - uv

- name: Execute uv installer
  ansible.builtin.shell: |
    set -o pipefail
    UV_INSTALL_DIR="{{ ansible_facts['user_dir'] }}/.local/bin" bash /tmp/install-uv.sh
  args:
    creates: "{{ ansible_facts['user_dir'] }}/.local/bin/uv"
  register: developer_uv_install
  when: not developer_uv_check.stat.exists
  become: false
  tags:
    - python
    - uv

- name: Clean up uv installer script
  ansible.builtin.file:
    path: /tmp/install-uv.sh
    state: absent
  when: not developer_uv_check.stat.exists
  tags:
    - python
    - uv

- name: Verify uv installation
  ansible.builtin.command:
    cmd: "{{ ansible_facts['user_dir'] }}/.local/bin/uv --version"
  register: developer_uv_version
  changed_when: false
  become: false
  tags:
    - python
    - uv

- name: Display uv version
  ansible.builtin.debug:
    msg: "uv {{ developer_uv_version.stdout }} installed"
  when: developer_uv_version.stdout is defined
  tags:
    - python
    - uv
