---
# SPDX-License-Identifier: MIT-0
# Install local font files system-wide for all users

- name: Ensure system fonts directory exists
  ansible.builtin.file:
    path: /usr/local/share/fonts
    state: directory
    mode: "0755"
    owner: root
    group: root

- name: Find all font files in role
  ansible.builtin.find:
    paths: "{{ role_path }}/file"
    recurse: true
    patterns:
      - "*.ttf"
      - "*.otf"
      - "*.woff"
      - "*.woff2"
      - "*.TTF"
      - "*.OTF"
  register: font_files
  delegate_to: localhost

- name: Copy fonts to system font directory
  ansible.builtin.copy:
    src: "{{ item.path }}"
    dest: "/usr/local/share/fonts/{{ item.path | basename }}"
    mode: "0644"
    owner: root
    group: root
    force: false
  loop: "{{ font_files.files }}"
  when: font_files.files | length > 0

- name: Update font cache
  ansible.builtin.command:
    cmd: fc-cache -f
  register: font_cache_result
  changed_when: false
  when: font_files.files | length > 0
