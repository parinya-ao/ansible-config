---
# SPDX-License-Identifier: MIT-0
# Locale role - Main entry point
# This role enforces English-only environment on Fedora Workstation through:
# - System locale configuration
# - XDG directory management
# - Input method configuration
# - CLI/TTY language enforcement

# =============================================================================
# ENVIRONMENT DETECTION (Container-Aware Design)
# =============================================================================
# Detect if running in a container to skip systemd-dependent commands
# In containers (CI): systemd is not PID 1, localectl/systemd commands fail
# On bare metal/workstation: systemd is available, full configuration applies

- name: "GATHER: Detect if running in a container"
  ansible.builtin.set_fact:
    locale_is_container: >-
      {{ ansible_virtualization_type in ['docker', 'container', 'podman', 'lxc', 'openvz']
      or ansible_env.CI is defined
      or ansible_env.GITHUB_ACTIONS is defined }}

# Pre-flight Validation
- name: Run pre-flight validation
  ansible.builtin.import_tasks: preflight.yml
  tags:
    - locale
    - preflight

# System Locale Configuration
- name: Configure system locale
  ansible.builtin.import_tasks: system_locale.yml
  when: locale_configure_system_locale
  tags:
    - locale
    - system-locale

# XDG User Directories
- name: Configure XDG user directories
  ansible.builtin.import_tasks: xdg_dirs.yml
  when: locale_configure_xdg_dirs
  tags:
    - locale
    - xdg-dirs

# Input Method Configuration
- name: Configure input method
  ansible.builtin.import_tasks: input_method.yml
  when: locale_configure_input_method
  tags:
    - locale
    - input-method

# CLI/TTY Language Enforcement
- name: Enforce CLI language
  ansible.builtin.import_tasks: cli_language.yml
  when: locale_enforce_cli_language
  tags:
    - locale
    - cli-language
