---
# SPDX-License-Identifier: MIT-0
# Common role - Main entry point
# This role configures the base system with:
# - DNF package manager optimization
# - System package updates
# - Essential base packages
# - Repository configuration (RPM Fusion)
# - NVIDIA drivers (optional)
# - System optimizations

# Pre-flight Validation (replaces shell-based checks)
- name: Run pre-flight validation
  ansible.builtin.import_tasks: preflight.yml
  tags:
    - common
    - preflight

# Repository Configuration
- name: Configure repositories
  ansible.builtin.import_tasks: repositories.yml
  tags:
    - common
    - repositories

# DNF Configuration
- name: Configure DNF package manager
  ansible.builtin.import_tasks: dnf.yml
  tags:
    - common
    - dnf

# System Update
- name: Perform system update
  ansible.builtin.import_tasks: system-update.yml
  tags:
    - common
    - system-update

# Fish Shell - Install early so it's available for the rest of the playbook
- name: Install Fish shell
  ansible.builtin.import_tasks: fish.yml
  when: common_install_fish
  tags:
    - common
    - fish
    - shell

# Base Packages Installation
- name: Install base packages
  ansible.builtin.import_tasks: packages.yml
  tags:
    - common
    - packages

# NVIDIA Drivers
- name: Install NVIDIA drivers
  ansible.builtin.import_tasks: nvidia.yml
  tags:
    - common
    - nvidia

# Firmware Updates
- name: Update firmware
  ansible.builtin.import_tasks: firmware.yml
  tags:
    - common
    - firmware

# System Optimizations
- name: Apply system optimizations
  ansible.builtin.import_tasks: optimizations.yml
  tags:
    - common
    - optimizations

# System Maintenance
- name: Configure system maintenance tasks
  ansible.builtin.import_tasks: maintenance.yml
  tags:
    - common
    - maintenance

# D2 Diagram Compiler
- name: Install D2 diagram compiler
  ansible.builtin.import_tasks: d2.yml
  when: common_install_d2 | bool
  tags:
    - common
    - d2
