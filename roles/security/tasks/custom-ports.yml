#SPDX-License-Identifier: MIT-0
---
# Custom ports configuration using firewalld

- name: Open custom ports in firewalld
  ansible.builtin.shell:
    cmd: firewall-cmd --permanent --add-port={{ item.port }}/{{ item.protocol | default('tcp') }}
  loop: "{{ security_custom_ports }}"
  when: (item.state | default('enabled')) == 'enabled'
  become: true
  register: custom_ports_result
  tags:
    - firewalld
    - custom-ports

- name: Reload firewalld for custom ports
  ansible.builtin.shell:
    cmd: firewall-cmd --reload
  become: true
  when: custom_ports_result.changed | default(false)
  tags:
    - firewalld
    - custom-ports

- name: Display custom ports rules
  ansible.builtin.debug:
    msg: "âœ“ Port {{ item.port }}/{{ item.protocol | default('tcp') }} is now {{ item.state | default('enabled') }}"
  loop: "{{ security_custom_ports }}"
  tags:
    - firewalld
    - custom-ports
