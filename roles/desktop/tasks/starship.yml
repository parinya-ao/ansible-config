# SPDX-License-Identifier: MIT-0
---
# Install and configure Starship prompt

- name: Check if Starship is installed
  ansible.builtin.stat:
    path: /usr/local/bin/starship
  register: desktop_starship_check

- name: Install Starship prompt
  ansible.builtin.get_url:
    url: "{{ desktop_starship_install_url }}"
    dest: /tmp/starship-install.sh
    mode: "0755"
  when: not desktop_starship_check.stat.exists

- name: Run Starship installer
  ansible.builtin.command: /tmp/starship-install.sh --yes
  args:
    creates: /usr/local/bin/starship
  when: not desktop_starship_check.stat.exists

- name: Configure Starship for bash
  ansible.builtin.lineinfile:
    path: /etc/bashrc
    line: 'eval "$(starship init bash)"'
    state: present
    create: true
    mode: "0644"

- name: Ensure fish config directory exists
  ansible.builtin.file:
    path: /etc/fish
    state: directory
    mode: "0755"

- name: Configure Starship for fish
  ansible.builtin.lineinfile:
    path: "{{ desktop_starship_fish_config_path }}"
    line: "starship init fish | source"
    state: present
    create: true
    mode: "0644"

- name: Ensure user config directory exists
  ansible.builtin.file:
    path: "{{ ansible_facts.env.HOME }}/.config"
    state: directory
    mode: "0755"

- name: Copy starship.toml configuration for user
  ansible.builtin.copy:
    src: starship/starship.toml
    dest: "{{ ansible_facts.env.HOME }}/.config/starship.toml"
    mode: "0644"
    force: true
