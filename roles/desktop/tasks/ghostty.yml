# SPDX-License-Identifier: MIT-0
---
# Install Ghostty terminal emulator
# Ghostty is a fast, feature-rich, and cross-platform terminal emulator
# Repository: https://github.com/ghostty-org/ghostty
# COPR: https://copr.fedorainfracloud.org/coprs/scottames/ghostty/

- name: Check if Ghostty is already installed
  ansible.builtin.command: which ghostty
  register: desktop_ghostty_binary
  changed_when: false
  failed_when: false

- name: Check if Ghostty COPR repository is enabled
  ansible.builtin.stat:
    path: /etc/yum.repos.d/_copr:copr.fedorainfracloud.org:scottames:ghostty.repo
  register: desktop_ghostty_copr_repo

- name: Enable Ghostty COPR repository
  ansible.builtin.command: dnf copr enable -y scottames/ghostty
  when:
    - not desktop_ghostty_copr_repo.stat.exists
    - desktop_ghostty_binary.rc != 0
  register: desktop_ghostty_copr_enable
  changed_when: desktop_ghostty_copr_enable.rc == 0

- name: Install Ghostty terminal emulator
  ansible.builtin.dnf:
    name: ghostty
    state: present
  when: desktop_ghostty_binary.rc != 0

- name: Configure Ctrl+Alt+T keyboard shortcut for Ghostty
  ansible.builtin.command: >
    gsettings set org.gnome.settings-daemon.plugins.media-keys
    custom-keybindings "['/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom0/']"
  when: desktop_ghostty_binary.rc == 0 or desktop_ghostty_copr_enable is succeeded
  changed_when: true

- name: Set Ghostty keyboard shortcut name
  ansible.builtin.command: >
    gsettings set org.gnome.settings-daemon.plugins.media-keys.custom-keybinding:/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom0/
    name 'Ghostty Terminal'
  when: desktop_ghostty_binary.rc == 0 or desktop_ghostty_copr_enable is succeeded
  changed_when: true

- name: Set Ghostty keyboard shortcut command
  ansible.builtin.command: >
    gsettings set org.gnome.settings-daemon.plugins.media-keys.custom-keybinding:/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom0/
    command 'ghostty'
  when: desktop_ghostty_binary.rc == 0 or desktop_ghostty_copr_enable is succeeded
  changed_when: true

- name: Set Ghostty keyboard shortcut binding (Ctrl+Alt+T)
  ansible.builtin.command: >
    gsettings set org.gnome.settings-daemon.plugins.media-keys.custom-keybinding:/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom0/
    binding '<Ctrl><Alt>t'
  when: desktop_ghostty_binary.rc == 0 or desktop_ghostty_copr_enable is succeeded
  changed_when: true

- name: Display Ghostty installation complete
  ansible.builtin.debug:
    msg: "Ghostty terminal emulator installed successfully with Ctrl+Alt+T shortcut configured."
