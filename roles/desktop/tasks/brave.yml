# SPDX-License-Identifier: MIT-0
---
# Install Brave browser

- name: Install DNF core plugins for Brave
  ansible.builtin.dnf:
    name: dnf-plugins-core
    state: present
  become: true

- name: Add Brave repository
  ansible.builtin.get_url:
    url: https://brave-browser-rpm-release.s3.brave.com/brave-browser.repo
    dest: /etc/yum.repos.d/brave-browser.repo
    owner: root
    group: root
    mode: '0644'
  become: true

- name: Import Brave GPG key
  ansible.builtin.rpm_key:
    state: present
    key: https://brave-browser-rpm-release.s3.brave.com/brave-core.asc
  become: true

- name: Install Brave browser
  ansible.builtin.dnf:
    name: brave-browser
    state: latest
  become: true

- name: Fix Brave icon (copy to standard location)
  ansible.builtin.copy:
    src: /opt/brave.com/brave/product_logo_128.png
    dest: /usr/share/icons/hicolor/128x128/apps/brave-browser.png
    remote_src: true
    owner: root
    group: root
    mode: '0644'
  become: true
  register: icon_injected

- name: Refresh icon cache
  ansible.builtin.command: gtk-update-icon-cache /usr/share/icons/hicolor
  become: true
  when: icon_injected.changed

- name: Update desktop database
  ansible.builtin.command: update-desktop-database /usr/share/applications
  become: true
  when: icon_injected.changed

- name: Display Brave installation complete
  ansible.builtin.debug:
    msg: "Brave browser installed successfully."
