# SPDX-License-Identifier: MIT-0
# Ansible Performance Configuration
# Optimized for DNF5 and local execution

[defaults]
# --- Execution Performance ---
# Enable SSH pipelining to reduce connection overhead
pipelining = True

# Increase parallel execution (adjust based on CPU cores)
forks = 10

# --- Fact Caching (reduces redundant setup calls) ---
# Use jsonfile for persistent fact caching across runs
gathering = smart
fact_caching = jsonfile
fact_caching_connection = ./.ansible/facts
fact_caching_timeout = 86400

# Only gather necessary facts (exclude heavy collectors)
gather_subset = !facter,!ohai

# --- Performance Profiling ---
# Enable callbacks to identify slow tasks
callbacks_enabled = profile_tasks, timer

# --- Role & Collection Paths ---
roles_path = ./roles
collections_path = ./collections

# --- Output Formatting ---
stdout_callback = yaml
bin_ansible_callbacks = True

# --- Retry Files (disable to reduce I/O) ---
retry_files_enabled = False

# --- Host Key Checking ---
# Disable for local/CI environments (enable for production)
host_key_checking = False

# --- Deprecation Warnings ---
deprecation_warnings = False

[ssh_connection]
# --- SSH Performance Optimization ---
# Persistent SSH connections with 5-minute timeout
ssh_args = -o ControlMaster=auto -o ControlPersist=300s -o UserKnownHostsFile=/dev/null

# Enable pipelining at SSH level
pipelining = True

# Reduce SSH retries for faster failure detection
retries = 2

[privilege_escalation]
become = True
become_method = sudo
become_user = root
become_ask_pass = False

[inventory]
# Enable inventory caching for dynamic sources
cache = True
cache_plugin = jsonfile
cache_connection = ./.ansible/inventory_cache
cache_timeout = 86400
